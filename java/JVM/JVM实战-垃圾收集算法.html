<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>elbowH的博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="记录学习过程">
    
    <link rel="preload" href="/mynotes/assets/css/0.styles.1c00a5d2.css" as="style"><link rel="preload" href="/mynotes/assets/js/app.f65f9fb1.js" as="script"><link rel="preload" href="/mynotes/assets/js/2.7a2c11e9.js" as="script"><link rel="preload" href="/mynotes/assets/js/5.dba54d81.js" as="script"><link rel="prefetch" href="/mynotes/assets/js/10.7ac305b1.js"><link rel="prefetch" href="/mynotes/assets/js/11.36532f04.js"><link rel="prefetch" href="/mynotes/assets/js/12.75928cce.js"><link rel="prefetch" href="/mynotes/assets/js/13.50300c4e.js"><link rel="prefetch" href="/mynotes/assets/js/14.23c58989.js"><link rel="prefetch" href="/mynotes/assets/js/15.7f2952d0.js"><link rel="prefetch" href="/mynotes/assets/js/16.c6c9a35b.js"><link rel="prefetch" href="/mynotes/assets/js/17.026a9b21.js"><link rel="prefetch" href="/mynotes/assets/js/18.33a22882.js"><link rel="prefetch" href="/mynotes/assets/js/19.5bae9800.js"><link rel="prefetch" href="/mynotes/assets/js/3.10239fd0.js"><link rel="prefetch" href="/mynotes/assets/js/4.6de9dd4b.js"><link rel="prefetch" href="/mynotes/assets/js/6.f54abc5a.js"><link rel="prefetch" href="/mynotes/assets/js/7.c1be93cc.js"><link rel="prefetch" href="/mynotes/assets/js/8.7beb05ff.js"><link rel="prefetch" href="/mynotes/assets/js/9.ece7952f.js">
    <link rel="stylesheet" href="/mynotes/assets/css/0.styles.1c00a5d2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mynotes/" class="home-link router-link-active"><!----> <span class="site-name">elbowH的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mynotes/" class="nav-link">
  主页
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mynotes/" class="nav-link">
  主页
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>JVM</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mynotes/java/JVM/JVM实战-内存模型.html" class="sidebar-link">JVM实战-内存模型</a></li><li><a href="/mynotes/java/JVM/JVM实战-垃圾收集器.html" class="sidebar-link">JVM实战-垃圾收集器</a></li><li><a href="/mynotes/java/JVM/JVM实战-垃圾收集算法.html" class="active sidebar-link">JVM实战-垃圾收集算法</a></li><li><a href="/mynotes/java/JVM/JVM实战-对象实例化.html" class="sidebar-link">JVM实战-对象实例化</a></li></ul></section></li><li><a href="/mynotes/java/Java基础知识.html" class="sidebar-link">Java基础知识</a></li><li><a href="/mynotes/java/J2EE基础知识.html" class="sidebar-link">J2EE基础知识</a></li><li><a href="/mynotes/java/Java-Calendar.html" class="sidebar-link">Java-Calendar</a></li><li><a href="/mynotes/java/JDK7新特性概览.html" class="sidebar-link">JDK7新特性概览</a></li><li><a href="/mynotes/java/Java-Fork-Join-框架.html" class="sidebar-link">Java-Fork-Join-框架</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#_1-1-判定回收的对象">1.1 判定回收的对象</a></li><li><a href="#_3-1-回收废弃常量">3.1 回收废弃常量</a></li><li><a href="#_3-2-回收无用类">3.2 回收无用类</a></li><li><a href="#_4-1-标记-清除-mark-sweep">4.1 标记-清除(Mark-Sweep)</a><ul><li><a href="#不足">不足</a></li></ul></li><li><a href="#_4-2-复制算法-mark-copy">4.2 复制算法(Mark-Copy)</a><ul><li><a href="#_4-2-1-分析">4.2.1 分析</a></li><li><a href="#_4-2-2-解决空间利用率问题">4.2.2 解决空间利用率问题</a></li><li><a href="#_4-2-3-分配担保">4.2.3 分配担保</a></li></ul></li><li><a href="#_4-3-标记-压缩算法-mark-compact">4.3 标记-压缩算法(Mark-Compact)</a><ul><li><a href="#分析">分析</a></li></ul></li><li><a href="#_4-4-分代收集算法-generational-collection">4.4 分代收集算法(Generational Collection)</a></li></ul></div><p></p> <p>Java会对内存进行自动分配与回收管理，使上层业务更加安全，方便地使用内存实现程序逻辑
在不同的JVM实现及不同的回收机制中，堆内存的划分方式是不一样的
这里简要介绍垃圾回收( Garbage Collection, GC)。垃圾回收的主要目的是清除不再使用的对象，自动释放内存.</p> <h1 id="静态内存分配和回收"><a href="#静态内存分配和回收" class="header-anchor">#</a> 静态内存分配和回收</h1> <p>在程序开始运行时由编译器分配的内存
在被编译时就已经能够确定需要的空间,当程序被加载时系统把内存一次性分配给它,这些内存不会在程序执行时发生变化,直到程序执行结束时才回收内存.</p> <ul><li><p>包括原生数据类型及对象的引用</p></li> <li><p>这些静态内存空间在栈上分配,方法运行结束,对应的栈帧撤销,内存空间被回收.</p></li> <li><p>每个栈帧中的本地变量表都是在类被加载的时候就确定的,每一个栈帧中分配多少内存基本上是在类结构确定时就已知了,因此这几块区域内存分配和回收都具备确定性,就不需要过多考虑回收问题了</p></li></ul> <h1 id="动态内存分配和回收"><a href="#动态内存分配和回收" class="header-anchor">#</a> 动态内存分配和回收</h1> <ul><li>在程序执行时才知道要分配的存储空间大小,对象何时被回收也是不确定的,只有等到该对象不再使用才会被回收.</li></ul> <p>堆和方法区的内存回收具有不确定性,因此垃圾收集器在回收堆和方法区内存的时候花了一点心思.</p> <h1 id="_1-java堆内存的回收"><a href="#_1-java堆内存的回收" class="header-anchor">#</a> 1 Java堆内存的回收</h1> <h2 id="_1-1-判定回收的对象"><a href="#_1-1-判定回收的对象" class="header-anchor">#</a> 1.1 判定回收的对象</h2> <p>GC是如何判断对象是否可以被回收的呢?为了判断对象是否存活，JVM引入了GC Roots
如果一个对象与GC Roots之间没有直接或间接的引用关系，比如某个失去任何引用的对象，或者两个互相环岛状循环引用的对象等，判决这些对象“死缓”，是可以被回收的</p> <p>在对堆进行对象回收之前,首先要判断哪些是无效对象(一个对象不被任何对象或变量引用)需要被回收</p> <p>一般有两种判别方式:</p> <ul><li>引用计数法 (Reference Counting)
每个对象都有一个整型的计数器,当这个对象被一个变量或对象引用时，该计数器加一;当该引用失效时,计数器值减一.当计数器为0时,就认为该对象是无效对象.</li> <li>可达性分析法 (Reachability Analysis)
所有和GC Roots直接或间接关联的对象都是有效对象,和GC Roots没有关联的对象就是无效对象.
<img src="data:image/jpeg;base64,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" alt=""> <code>GC Roots对象</code></li> <li>虚拟机栈(栈帧中的本地变量表)中引用的对象</li> <li>方法区中静态属性引用的对象</li> <li>方法区中常量引用的对象</li> <li>本地方法栈JNI(native方法)引用的对象</li></ul> <blockquote><p><strong>GC Roots并不包括堆中对象所引用的对象！这样就不会出现循环引用.</strong></p></blockquote> <ul><li>两者对比
引用计数法虽然简单,但存在无法解决对象之间相互循环引用的严重问题,且伴随加减法操作的性能影响.</li></ul> <p>因此,目前主流语言均使用可达性分析方法来判断对象是否有效.</p> <h1 id="_2-回收无效对象的过程"><a href="#_2-回收无效对象的过程" class="header-anchor">#</a> 2 回收无效对象的过程</h1> <p>当经可达性算法筛选出失效的对象之后,并不是立即清除,而是再给对象一次重生的机会</p> <ul><li>判断是否覆盖finalize()
<ul><li>未覆盖该或已调用过该方法,直接释放对象内存</li> <li>已覆盖该方法且还未被执行,则将finalize()扔到F-Queue队列中</li></ul></li> <li>执行F-Queue中的finalize()
虚拟机会以较低的优先级执行这些finalize(),不会确保所有的finalize()都会执行结束
如果finalize()中出现耗时操作,虚拟机就直接停止执行,将该对象清除</li> <li>对象重生或死亡
<ul><li>如果在执行finalize()方法时,将this赋给了某一个引用,则该对象重生</li> <li>如果没有,那么就会被垃圾收集器清除</li></ul></li></ul> <blockquote><p>注意:强烈不建议使用finalize()进行任何操作!
如果需要释放资源,请用try-finally或者其他方式都能做得更好.
因为finalize()不确定性大,开销大,无法保证各个对象的调用顺序.</p></blockquote> <p>以下代码示例看到:一个对象的finalize被执行,但依然可以存活</p> <div class="language- extra-class"><pre class="language-text"><code>/**
 * 演示两点:
 * 1.对象可以在被GC时自救
 * 2.这种自救机会只有一次,因为一个对象的finalize()最多只能被系统自动调用一次,因此第二次自救失败
 * @author sss
 * @since 17-9-17 下午12:02
 *
 */
public class FinalizeEscapeGC {

    private static FinalizeEscapeGC SAVE_HOOK = null;

    private void isAlive() {
        System.out.println(&quot;yes,I am still alive :)&quot;);
    }

    @Override
    protected void finalize() throws Throwable {
        super.finalize();
        System.out.println(&quot;finalize methodd executed!&quot;);
        FinalizeEscapeGC.SAVE_HOOK = this;
    }


    public static void main(String[] args) throws InterruptedException {
        SAVE_HOOK = new FinalizeEscapeGC();

        // 对象第一次成功自救
        SAVE_HOOK = null;
        System.gc();
        // 因为finalize方法优先级很低,所以暂停0.5s以等待它
        Thread.sleep(500);
        if (SAVE_HOOK != null) {
            SAVE_HOOK.isAlive();
        } else {
            System.out.println(&quot;no,I am dead :(&quot;);
        }

        // 自救失败
        SAVE_HOOK = null;
        System.gc();
        Thread.sleep(500);
        if (SAVE_HOOK != null) {
            SAVE_HOOK.isAlive();
        } else {
            System.out.println(&quot;no,I am dead :(&quot;);
        }
    }
}
</code></pre></div><p>运行结果</p> <div class="language- extra-class"><pre class="language-text"><code>finalize methodd executed!
yes,I am still alive :)
no,I am dead :(
</code></pre></div><h1 id="_3-方法区的内存回收"><a href="#_3-方法区的内存回收" class="header-anchor">#</a> 3 方法区的内存回收</h1> <p>使用<code>复制算法</code>实现堆的内存回收,堆被分为<code>新生代</code>和<code>老年代</code></p> <ul><li>新生代中的对象&quot;朝生夕死&quot;,每次垃圾回收都会清除掉大量对象</li> <li>老年代中的对象生命较长,每次垃圾回收只有少量的对象被清除</li></ul> <p>由于方法区中存放生命周期较长的类信息、常量、静态变量.
因此方法区就像堆的老年代,每次GC只有少量垃圾被清除.</p> <p>方法区中主要清除两种垃圾</p> <ul><li>废弃常量</li> <li>无用类</li></ul> <h2 id="_3-1-回收废弃常量"><a href="#_3-1-回收废弃常量" class="header-anchor">#</a> 3.1 回收废弃常量</h2> <p>回收废弃常量和回收对象类似,只要常量池中的常量不被任何变量或对象引用,那么这些常量就会被清除.</p> <h2 id="_3-2-回收无用类"><a href="#_3-2-回收无用类" class="header-anchor">#</a> 3.2 回收无用类</h2> <p>判定无用类的条件则较为苛刻</p> <ul><li>该类所有实例都已被回收
即Java堆不存在该类的任何实例</li> <li>加载该类的ClassLoader已被回收</li> <li>该类的java.lang.Class对象没有被任何对象或变量引用,无法通过反射访问该类的方法
只要一个类被虚拟机加载进方法区,那么在堆中就会有一个代表该类的对象:java.lang.Class.这个对象在类被加载进方法区的时候创建,在方法区中该类被删除时清除.</li></ul> <h1 id="_4-垃圾收集算法"><a href="#_4-垃圾收集算法" class="header-anchor">#</a> 4 垃圾收集算法</h1> <h2 id="_4-1-标记-清除-mark-sweep"><a href="#_4-1-标记-清除-mark-sweep" class="header-anchor">#</a> 4.1 标记-清除(Mark-Sweep)</h2> <p><code>最基础</code>的收集算法,后续算法也都是基于此并改进其不足而得.</p> <p>该算法会从每个GC Roots出发，依次标记有引用关系的对象，最后将没有被标记的对象清除</p> <h3 id="不足"><a href="#不足" class="header-anchor">#</a> 不足</h3> <p>这种算法会带来大量的空间碎片，导致需要分配一个较大连续空间时容易触发FullGC,降低了空间利用率.
<img src="/mynotes/assets/img/1240-16841490563531-16841490889479.341d0004.jpg" alt="标记-清除算法"></p> <p>为了解决这个问题，又提出了“标记-整理算法”，该算法类似计算机的磁盘整理，首先会从GC Roots出发标记存活的对象，然后将存活对象整理到内存空间的一端，形成连续的已使用空间，最后把已使用空间之外的部分全部清理掉，这样就不会产生空间碎片的问题</p> <h2 id="_4-2-复制算法-mark-copy"><a href="#_4-2-复制算法-mark-copy" class="header-anchor">#</a> 4.2 复制算法(Mark-Copy)</h2> <p>为了能够并行地标记和整理将空间分为两块,每次只激活其中一块,垃圾回收时只需把存活的对象复制到另一块未激活空间上,将未激活空间标记为已激活,将已激活空间标记为未激活,然后清除原空间中的原对象</p> <p>将内存分成大小相等两份,只将数据存储在其中一块上</p> <ul><li>当需要回收时,首先标记废弃数据</li> <li>然后将有用数据复制到另一块内存</li> <li>最后将第一块内存空间全部清除
<img src="data:image/jpeg;base64,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" alt="复制算法"></li></ul> <h3 id="_4-2-1-分析"><a href="#_4-2-1-分析" class="header-anchor">#</a> 4.2.1 分析</h3> <ul><li>这种算法避免了空间碎片,但内存缩小了一半.</li> <li>每次都需将有用数据全部复制到另一片内存,效率不高</li></ul> <h3 id="_4-2-2-解决空间利用率问题"><a href="#_4-2-2-解决空间利用率问题" class="header-anchor">#</a> 4.2.2 解决空间利用率问题</h3> <p>堆内存空间分为较大的Eden和两块较小的Survivor,每次只使用Eden和Survivor区的一块。这种情形下的“ Mark-Copy&quot;减少了内存空间的浪费。“Mark-Copy”现作为主流的YGC算法进行新生代的垃圾回收。
在新生代中,由于大量对象都是&quot;朝生夕死&quot;,也就是一次垃圾收集后只有少量对象存活
因此我们可以将内存划分成三块</p> <ul><li><code>Eden、Survior1、Survior2</code></li> <li>内存大小分别是8:1:1</li></ul> <p>分配内存时,只使用Eden和一块Survior1.</p> <ul><li>当发现Eden+Survior1的内存即将满时,JVM会发起一次<code>Minor GC</code>,清除掉废弃的对象,</li> <li>并将所有存活下来的对象复制到另一块Survior2中.</li> <li>接下来就使用Survior2+Eden进行内存分配</li></ul> <p>通过这种方式,只需要浪费10%的内存空间即可实现带有压缩功能的垃圾收集方法,避免了内存碎片的问题.</p> <h3 id="_4-2-3-分配担保"><a href="#_4-2-3-分配担保" class="header-anchor">#</a> 4.2.3 分配担保</h3> <p>准备为一个对象分配内存时,发现此时Eden+Survior中空闲的区域无法装下该对象
就会触发<code>MinorGC</code>(新生代 GC 算法),对该区域的废弃对象进行回收.</p> <p>但如果MinorGC过后只有少量对象被回收,仍然无法装下新对象</p> <ul><li>那么此时需要将Eden+Survior中的<code>所有对象</code>都<code>转移到老年代</code>中,然后再将新对象存入Eden区.这个过程就是&quot;分配担保&quot;.</li></ul> <p>在发生 minor gc 前，虚拟机会检测<code>老年代最大可用连续空间是否大于新生代所有对象总空间</code>
若成立，minor gc 可确保安全
若不成立，JVM会查看 <code>HandlePromotionFailure</code>是否允许担保失败</p> <ul><li>若允许
那么会继续检测老年代最大可用的连续空间是否 &gt; 历次晋升到老年代对象的平均大小
<ul><li>若大于
则将尝试进行一次 minor gc，尽管这次 minor gc 是有风险的</li> <li>若小于或 HandlePromotionFailure 设置不允许冒险
改为进行一次 full gc (老年代GC)</li></ul></li></ul> <h2 id="_4-3-标记-压缩算法-mark-compact"><a href="#_4-3-标记-压缩算法-mark-compact" class="header-anchor">#</a> 4.3 标记-压缩算法(Mark-Compact)</h2> <p>在回收前,标记过程仍与&quot;标记-清除&quot;一样
但后续不是直接清理可回收对象,而是</p> <ul><li>将所有存活对象移到一端</li> <li>直接清掉端边界之外内存
<img src="data:image/jpeg;base64,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" alt="标记-整理算法"></li></ul> <h3 id="分析"><a href="#分析" class="header-anchor">#</a> 分析</h3> <p>这是一种<strong>老年代垃圾收集算法</strong>.
老年代中对象一般寿命较长,每次垃圾回收会有大量对象存活
因此如果选用&quot;复制&quot;算法,每次需要較多的复制操作,效率低</p> <p>而且,在新生代中使用&quot;复制&quot;算法
当 Eden+Survior 都装不下某个对象时,可使用老年代内存进行&quot;分配担保&quot;</p> <p>而如果在老年代使用该算法,那么在老年代中如果出现 Eden+Survior 装不下某个对象时,没有其他区域给他作分配担保</p> <p>因此,老年代中一般使用&quot;标记-压缩&quot;算法</p> <h2 id="_4-4-分代收集算法-generational-collection"><a href="#_4-4-分代收集算法-generational-collection" class="header-anchor">#</a> 4.4 分代收集算法(Generational Collection)</h2> <p>当前商业虚拟机都采用此算法.
根据对象存活周期的不同将Java堆划分为老年代和新生代,根据各个年代的特点使用最佳的收集算法.</p> <ul><li>老年代中对象存活率高,无额外空间对其分配担保,必须使用&quot;标记-清除&quot;或&quot;标记-压缩&quot;算法</li> <li>新生代中存放&quot;朝生夕死&quot;的对象,用复制算法,只需要付出少量存活对象的复制成本,就可完成收集</li></ul> <h1 id="_5-java中引用的种类"><a href="#_5-java中引用的种类" class="header-anchor">#</a> 5 Java中引用的种类</h1> <p>Java中根据生命周期的长短,将引用分为4类</p> <ul><li>强引用
我们平时所使用的引用就是强引用
类似<code>A a = new A();</code>
即通过关键字new创建的对象所关联的引用就是强引用
只要强引用还存在,该对象永远不会被回收</li> <li>软引用
一些还有用但并非必需的对象
只有当堆即将发生OOM异常时,JVM才会回收软引用所指向的对象.
软引用通过SoftReference类实现
软引用的生命周期比强引用短一些</li> <li>弱引用
也是描述非必需对象,比软引用更弱
所关联的对象只能存活到下一次GC发生前.
只要垃圾收集器工作,无论内存是否足够,弱引用所关联的对象都会被回收.
弱引用通过WeakReference类实现.</li> <li>虚引用
也叫幽灵(幻影)引用,最弱的引用关系.
它和没有引用没有区别,无法通过虚引用取得对象实例.
设置虚引用唯一的作用就是在该对象被回收之前收到一条系统通知.
虚引用通过PhantomReference类来实现.</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mynotes/java/JVM/JVM实战-垃圾收集器.html" class="prev">
        JVM实战-垃圾收集器
      </a></span> <span class="next"><a href="/mynotes/java/JVM/JVM实战-对象实例化.html">
        JVM实战-对象实例化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/mynotes/assets/js/app.f65f9fb1.js" defer></script><script src="/mynotes/assets/js/2.7a2c11e9.js" defer></script><script src="/mynotes/assets/js/5.dba54d81.js" defer></script>
  </body>
</html>
