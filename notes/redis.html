<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis | elbowH的博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="记录学习过程">
    
    <link rel="preload" href="/mynotes/assets/css/0.styles.46e81577.css" as="style"><link rel="preload" href="/mynotes/assets/js/app.349c0ccc.js" as="script"><link rel="preload" href="/mynotes/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/mynotes/assets/js/11.6a2f3488.js" as="script"><link rel="prefetch" href="/mynotes/assets/js/10.dc8bf6af.js"><link rel="prefetch" href="/mynotes/assets/js/3.4122aa84.js"><link rel="prefetch" href="/mynotes/assets/js/4.fc333d27.js"><link rel="prefetch" href="/mynotes/assets/js/5.bfef3080.js"><link rel="prefetch" href="/mynotes/assets/js/6.2d0a63f8.js"><link rel="prefetch" href="/mynotes/assets/js/7.9c9172a7.js"><link rel="prefetch" href="/mynotes/assets/js/8.7954a9f8.js"><link rel="prefetch" href="/mynotes/assets/js/9.0b63b925.js">
    <link rel="stylesheet" href="/mynotes/assets/css/0.styles.46e81577.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mynotes/" class="home-link router-link-active"><!----> <span class="site-name">elbowH的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mynotes/" class="nav-link">
  主页
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mynotes/" class="nav-link">
  主页
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/mynotes/notes/" aria-current="page" class="sidebar-link">介绍</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/mynotes/notes/one" class="sidebar-heading clickable"><span>one</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redis"><a href="#redis" class="header-anchor">#</a> Redis</h1> <h2 id="_1-redis是什么"><a href="#_1-redis是什么" class="header-anchor">#</a> 1. Redis是什么</h2> <p>Redis（Remote Dictionary Server）是一个key-value的NoSQL产品，数据都是缓存在内存中，周期性的数据持久化。
  Redis是一个开源的使用ANSI C语言编写、遵守BSD协议、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。它通常被称为数据结构服务器，因为值（value）可以是 字符串(String)、 哈希(Map)、列表(list)、 集合(sets) 和 有序集合(sorted sets)等类型。</p> <h3 id="_1-1-三个特点"><a href="#_1-1-三个特点" class="header-anchor">#</a> 1.1 三个特点</h3> <p>1、Redis 支持数据持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。
2、Redis 提供 list，set，zset，hash等数据结构缓存。
3、Redis支持数据的备份。</p> <h3 id="_1-2-redis优势"><a href="#_1-2-redis优势" class="header-anchor">#</a> 1.2 Redis优势</h3> <p>1、性能极高-Redis能读的速度是110000次/s，写的速度是81000次/s。
2、丰富的数据类型-Redis支持二进制案例的lists，sets，Hashes及sets Ordered数据类型操作。
3、丰富的特性-Redis还支持public/subscribe。</p> <h3 id="_1-3-redis与其他key-value存储的不同"><a href="#_1-3-redis与其他key-value存储的不同" class="header-anchor">#</a> 1.3 Redis与其他key-value存储的不同</h3> <p>1、Redis有着更为复杂的数据结构并且提供对他们的原子性操作，这是一个不同于其他数据库的进化路径。
2、Redis的数据类型都是基于基本数据结构的同时对程序员透明，无需进行额外的抽象。</p> <h2 id="_2-linux安装redis"><a href="#_2-linux安装redis" class="header-anchor">#</a> 2 linux安装Redis</h2> <h3 id="_2-1-docker搜索redis镜像"><a href="#_2-1-docker搜索redis镜像" class="header-anchor">#</a> 2.1 Docker搜索redis镜像</h3> <blockquote><p>命令：docker search &lt;镜像名称&gt;</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>docker search redis
</code></pre></div><p><img src="C:%5CUsers%5C10092%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20230223155759120.png" alt="image-20230223155759120"></p> <h3 id="_2-2-docker拉取镜像"><a href="#_2-2-docker拉取镜像" class="header-anchor">#</a> 2.2 Docker拉取镜像</h3> <blockquote><p>命令：：docker pull &lt;镜像名称&gt;:&lt;版本号&gt;</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>docker pull redis
</code></pre></div><h3 id="_2-3-docker挂载配置文件"><a href="#_2-3-docker挂载配置文件" class="header-anchor">#</a> 2.3 Docker挂载配置文件</h3> <p>接下来就是要将redis 的配置文件进行挂载，以配置文件方式启动redis 容器。（挂载：即将宿主的文件和容器内部目录相关联，相互绑定，在宿主机内修改文件的话也随之修改容器内部文件）</p> <p>1）、挂载 redis 的配置文件</p> <p>2）、挂载 redis 的持久化文件（为了数据的持久化）。</p> <p>liunx 下redis.conf文件位置： /home/redis/myredis/redis.conf</p> <p>liunx 下redis的data文件位置 ： /home/redis/myredis/data</p> <h3 id="_2-4-启动redis-容器"><a href="#_2-4-启动redis-容器" class="header-anchor">#</a> 2.4  启动redis 容器</h3> <div class="language- extra-class"><pre class="language-text"><code>docker run --restart=always --log-opt max-size=100m --log-opt max-file=2 -p 6379:6379 --name myredis -v /home/redis/myredis/myredis.conf:/etc/redis/redis.conf -v /home/redis/myredis/data:/data -d redis redis-server /etc/redis/redis.conf  --appendonly yes  --requirepass 123456
</code></pre></div><ol><li><code>--restart=always</code> 总是开机启动</li> <li><code>--log</code>是日志方面的</li> <li><code>-p 6379:6379</code> 将6379端口挂载出去</li> <li><code>--name</code> 给这个容器取一个名字</li> <li>-v 数据卷挂载
<ul><li>/home/redis/myredis/myredis.conf:/etc/redis/redis.conf 这里是将 liunx 路径下的myredis.conf 和redis下的redis.conf 挂载在一起。</li> <li>/home/redis/myredis/data:/data 这个同上</li></ul></li> <li><code>-d redis</code> 表示后台启动redis</li> <li><code>redis-server /etc/redis/redis.conf</code> 以配置文件启动redis，加载容器内的conf文件，最终找到的是挂载的目录 <code>/etc/redis/redis.conf</code> 也就是liunx下的/home/redis/myredis/myredis.conf</li> <li><code>–appendonly yes</code> 开启redis 持久化</li> <li>–requirepass 123456设置密码</li></ol> <p><img src="https://img-blog.csdnimg.cn/f2c7c58a3f1740c2b1d0a750f671f6eb.png#pic_center" alt="在这里插入图片描述"></p> <h2 id="_3-测试"><a href="#_3-测试" class="header-anchor">#</a> 3 测试</h2> <h3 id="_3-1-通过docker-ps指令查看启动状态"><a href="#_3-1-通过docker-ps指令查看启动状态" class="header-anchor">#</a> 3.1  通过docker ps指令查看启动状态</h3> <div class="language- extra-class"><pre class="language-text"><code>docker ps -a |grep myredis # 通过docker ps指令查看启动状态，是否成功.
</code></pre></div><p><img src="C:%5CUsers%5C10092%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20230223162145014.png" alt="image-20230223162145014"></p> <h3 id="_3-2-查看容器运行日志"><a href="#_3-2-查看容器运行日志" class="header-anchor">#</a> 3.2 查看容器运行日志</h3> <blockquote><p>命令：docker logs --since 30m &lt;容器名&gt;</p></blockquote> <p>此处 <code>--since 30m</code> 是查看此容器30分钟之内的日志情况。</p> <div class="language- extra-class"><pre class="language-text"><code>docker logs --since 30m myredis
</code></pre></div><h3 id="_3-3-进入容器内部"><a href="#_3-3-进入容器内部" class="header-anchor">#</a> 3.3  进入容器内部</h3> <blockquote><p>命令：docker exec -it &lt;容器名&gt; redis-cli</p></blockquote> <h4 id="_3-3-1-验证密码"><a href="#_3-3-1-验证密码" class="header-anchor">#</a> 3.3.1 验证密码</h4> <div class="language- extra-class"><pre class="language-text"><code>auth 123456
</code></pre></div><p>查看当前redis有没有设置密码</p> <div class="language- extra-class"><pre class="language-text"><code>config get requirepass
</code></pre></div><h2 id="springboot整合redis"><a href="#springboot整合redis" class="header-anchor">#</a> SpringBoot整合Redis</h2> <ul><li>引入依赖</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>配置文件</li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token comment"># Redis服务器地址</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.232.135
    <span class="token comment"># Redis服务器端口号</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token comment"># 使用的数据库索引，默认是0</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token comment"># 连接超时时间</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
     <span class="token comment"># 设置密码</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
</code></pre></div><ul><li>测试代码</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">MybatisPlusDemoApplicationTests</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">Test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token class-name">ValueOperations</span> valueOperations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        valueOperations<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;str1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;asd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>valueOperations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;str&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="解决键乱码问题"><a href="#解决键乱码问题" class="header-anchor">#</a> <strong>解决键乱码问题</strong></h4> <p>查看刚刚存入<a href="https://so.csdn.net/so/search?q=Redis%E6%95%B0%E6%8D%AE%E5%BA%93&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">Redis数据库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的数据</p> <p><img src="C:%5CUsers%5C10092%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20230223173239264.png" alt="image-20230223173239264"></p> <p>是因为在使用默认的对象<code>redisTemplate</code>时，会把value值序列化为byte类型，所以就出现了上图的结果。</p> <h4 id="自定义序列化方式"><a href="#自定义序列化方式" class="header-anchor">#</a> 自定义序列化方式</h4> <p>JSON序列化器</p> <p>首先要编写一个配置类：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">UnknownHostException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建模板</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置连接工厂</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置序列化工具</span>
        <span class="token class-name">GenericJackson2JsonRedisSerializer</span> jsonRedisSerializer <span class="token operator">=</span>
                <span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// key和 hashKey采用 string序列化</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializer</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializer</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// value和 hashValue采用 JSON序列化</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>jsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="redis-conf配置文件"><a href="#redis-conf配置文件" class="header-anchor">#</a> Redis.conf配置文件</h2> <div class="language- extra-class"><pre class="language-text"><code># bind 192.168.1.100 10.0.0.1
# bind 127.0.0.1 ::1
#bind 127.0.0.1

protected-mode no
port 6379
tcp-backlog 511
requirepass 000415
timeout 0
tcp-keepalive 300
daemonize no
supervised no
pidfile /var/run/redis_6379.pid
loglevel notice
logfile &quot;&quot;
databases 30
always-show-logo yes
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir ./
replica-serve-stale-data yes
replica-read-only yes
repl-diskless-sync no
repl-disable-tcp-nodelay no
replica-priority 100
lazyfree-lazy-eviction no
lazyfree-lazy-expire no
lazyfree-lazy-server-del no
replica-lazy-flush no
appendonly yes
appendfilename &quot;appendonly.aof&quot;
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-load-truncated yes
aof-use-rdb-preamble yes
lua-time-limit 5000
slowlog-max-len 128
notify-keyspace-events &quot;&quot;
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
hll-sparse-max-bytes 3000
stream-node-max-bytes 4096
stream-node-max-entries 100
activerehashing yes
hz 10
dynamic-hz yes
aof-rewrite-incremental-fsync yes
rdb-save-incremental-fsync yes
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/mynotes/assets/js/app.349c0ccc.js" defer></script><script src="/mynotes/assets/js/2.733019b2.js" defer></script><script src="/mynotes/assets/js/11.6a2f3488.js" defer></script>
  </body>
</html>
